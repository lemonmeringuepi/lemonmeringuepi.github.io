I"¨c<p><em>You can find the Jupyter Notebook for this project <a href="https://github.com/lemonmeringuepi/okcupid">here</a>. For access to the .csv file, which was too large to upload to Github, use the Contact form on my website.</em></p>

<h2 id="beep-boop-beep">Beep‚Ä¶ Boop‚Ä¶ Beep‚Ä¶</h2>

<p>Part of my <a href="https://lemonmeringuepi.github.io/project/okc-analysis">OKCupid Capstone Project</a> was to utilize machine learning to create a classification model. As a linguist, my mind immediately went to Naive Bayes classification‚Äì does the way we speak about ourselves, our relationships, and the world around us give away who we are?</p>

<p>During the early days of data cleaning, my shower thoughts consumed me. Do I break down the data by education? Vocabulary and spelling could differ by how much time we‚Äôve spent in school. By race? I‚Äôm sure that oppression has an effect on how people speak about the world around them, but I‚Äôm not the person to provide expert insights into race. I could do age or gender‚Ä¶ What about sexuality? I mean, sexuality has been one of my loves since well before I started attending conferences like the <a href="https://www.woodhullfoundation.org/sexual-freedom-summit/">Woodhull Sexual Freedom Summit</a> and <a href="https://twitter.com/catalystcon">Catalyst Con</a>, or teaching adults about sex and sexuality on the side. I finally had a goal for a project and I called it‚Äì wait for it‚Äì</p>

<p>The Gaydar.</p>

<hr />

<p><em>TL;DR: The Gaydar used Naive Bayes and Random Forests to categorize users as straight or queer with an accuracy score of 94.5%. I was able to replicate the experiment on a small sample of current profiles with 100% accuracy.</em></p>

<hr />

<h2 id="cleaning-the-data">Cleaning the Data:</h2>

<h3 id="the-beginning">The Beginning</h3>

<p>The OKCupid data provided included 59,946 profiles that were active between June, 2011 and July, 2012. Most values were strings, which was exactly what I didn‚Äôt want for my model.</p>

<p>Columns like status, smokes, sex, job, education, drugs, drinks, diet, and body were easy: I could just set a dictionary and create a new column by mapping the values from the old column to the dictionary.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">status_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'unknown'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">'single'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'available'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s">'seeing someone'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'married'</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s">'status_code'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'status'</span><span class="p">].</span><span class="nb">map</span><span class="p">(</span><span class="n">status_map</span><span class="p">)</span>
</code></pre></div></div>
<p>The speaks column wasn‚Äôt terrible, either. I had considered breaking it down by language, but decided it would be more efficient to just count the number of languages spoken by each user. Thankfully, OKCupid put commas between selections. There were some users who chose not to complete this field, and we can safely assume that they are fluent in at least one language. I chose to fill their data with a placeholder.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'speaks'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'speaks'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="s">'unknown'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'languages_spoken'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">'speaks'</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="s">','</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>The religion, sign, kids, and pets columns were a little more complex. I wanted to know each user‚Äôs main choice for each field, but also what qualifiers they used to describe that choice. By performing a check to see if a qualifier was present, then performing a string split, I was able to create two columns describing my data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_religion</span><span class="p">(</span><span class="n">religion_str</span><span class="p">):</span>
    <span class="n">religion_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'unknown'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">'atheism'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s">'agnosticism'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s">'christianity'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'catholicism'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'judaism'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="s">'buddhism'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'hinduism'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">'islam'</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                   <span class="s">'other'</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
    <span class="k">if</span> <span class="s">' '</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">religion_str</span><span class="p">:</span>
        <span class="n">religion</span> <span class="o">=</span> <span class="n">religion_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">religion</span> <span class="o">=</span> <span class="n">religion_str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">religion_map</span><span class="p">[</span><span class="n">religion</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">get_religion_serious</span><span class="p">(</span><span class="n">religion_str</span><span class="p">):</span>
    <span class="n">serious_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">'and laughing about it'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="s">'but not too serious about it'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s">'and somewhat serious about it'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                   <span class="s">'and very serious about it'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="k">if</span> <span class="s">' '</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">religion_str</span><span class="p">:</span>
        <span class="n">serious_code</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">serious</span> <span class="o">=</span> <span class="n">religion_str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">serious_code</span> <span class="o">=</span> <span class="n">serious_map</span><span class="p">[</span><span class="n">serious</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">serious_code</span>
<span class="n">df</span><span class="p">[</span><span class="s">'religion'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'religion'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="s">'unknown'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'religion_code'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'religion'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">get_religion</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'religion_serious'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'religion'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="n">get_religion_serious</span><span class="p">)</span>
</code></pre></div></div>

<p>The ethnicity column was similar to the languages column, in that each value was a string of entries, separated by commas. However, I didn‚Äôt just want to know how many races the user input. I wanted specifics. This was slightly more effort. I first had to check the unique values for the ethnicity column, then I browsed through those values to see what options OKCupid gave to their users for race. Once I knew what I was working with, I created a column for each race, giving the user a 1 if they listed that race and a 0 if they didn‚Äôt.</p>

<p>I was also interested to see how many users were multiracial, so I created an additional column to display 1 if the sum of the user‚Äôs ethnicities exceeded 1.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="s">'unknown'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_white'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'white'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_black'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'black'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_other'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'other'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_hispanic'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'hispanic / latin'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_pacific_islander'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'pacific islander'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_native_american'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'native american'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_middle_eastern'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'middle eastern'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_indian'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'indian'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'ethnicity_asian'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s">'asian'</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s">'multiracial'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_white'</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_black'</span><span class="p">]</span> <span class="o">+</span>
                             <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_other'</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_hispanic'</span><span class="p">]</span> <span class="o">+</span>
                             <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_pacific_islander'</span><span class="p">]</span> <span class="o">+</span>
                             <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_native_american'</span><span class="p">]</span> <span class="o">+</span>
                             <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_middle_eastern'</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_indian'</span><span class="p">]</span> <span class="o">+</span> 
                             <span class="n">x</span><span class="p">[</span><span class="s">'ethnicity_asian'</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="the-essays">The Essays</h3>

<p>The essay questions at the time of data collection were as follows:</p>

<ul>
  <li>My self-summary</li>
  <li>What I‚Äôm doing with my life</li>
  <li>I‚Äôm really good at</li>
  <li>The first thing people notice about me</li>
  <li>Favorite books, movies, shows, music, and food</li>
  <li>Six things I could never do without</li>
  <li>I spend a lot of time thinking about</li>
  <li>On a typical Friday night I am</li>
  <li>The most private thing I‚Äôm willing to admit</li>
  <li>You should message me if</li>
</ul>

<p>Almost everyone filled out the first essay prompt, but they ran out of steam as they answered more. About a third of users abstained from completing the ‚ÄúThe most private thing I‚Äôm willing to admit‚Äù essay.</p>

<p><img src="https://github.com/lemonmeringuepi/okcupid/blob/master/blank_essays.png?raw=true" alt="A scatterplot titled, &quot;Blank Essays on OKCupid. The x-axis lists the above essay prompts and the y-axis shows how many of each essay was left incomplete. it ranges from about 4000-20000." /></p>

<p>Cleaning the essays for use took a lot of regular expressions, but first I had to replace null values with empty strings and concatenate each user‚Äôs essays.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">essay_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'essay0'</span><span class="p">,</span> <span class="s">'essay1'</span><span class="p">,</span> <span class="s">'essay2'</span><span class="p">,</span> <span class="s">'essay3'</span><span class="p">,</span> <span class="s">'essay4'</span><span class="p">,</span>
              <span class="s">'essay5'</span><span class="p">,</span> <span class="s">'essay6'</span><span class="p">,</span> <span class="s">'essay7'</span><span class="p">,</span> <span class="s">'essay8'</span><span class="p">,</span> <span class="s">'essay9'</span><span class="p">]</span>
<span class="n">all_essays</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">essay_cols</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">all_essays</span> <span class="o">=</span> <span class="n">all_essays</span><span class="p">[</span><span class="n">essay_cols</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>The most verbose user, a 36-year-old straight man, wrote an absolute novel‚Äì his concatenated essays had a whopping 96,277 character count! When I examined his essays, I saw that he used broken links on almost every line to highlight specific words and phrases. That meant that html had to go.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all_essays_clean</span> <span class="o">=</span> <span class="n">all_essays</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r'&lt;.*&gt;'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">all_essays_clean</span> <span class="o">=</span> <span class="n">all_essays_clean</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r'[-,\.;:\+\(\)/=\?\"&lt;&gt;%&amp;~\|\!\]\[]'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">all_essays_clean</span> <span class="o">=</span> <span class="n">all_essays_clean</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r'href|classilink'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">all_essays_clean</span> <span class="o">=</span> <span class="n">all_essays_clean</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r'http[\w\d]*'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<p>This brought his essay length down by almost 30,000 characters! Considering most other users clocked in below 5,000 characters, I felt that eliminating that much noise from the essays was a job well done.</p>

:ET